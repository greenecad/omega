{% extends 'base.html' %}

{% block header %}
  <h1>{% block title %}Profile{% endblock %}</h1>
{% endblock %}

{% block js %}
  <script defer src="{{ url_for('static', filename='js/profile.js') }}"></script>
{% endblock %}

{% block content %}
  {% for popup in popups %}
    <div class="modal" id ="modal-{{ loop.index }}">
      <span class = "modal-content">
        <span class="close">&times;</span>
        <p>{{ popup }}</p>
        <button class="close">Close</button>
      </span>
    </div>
  {% endfor %}

  <p>Username: {{ user.username }}</p>
  {% if user.points %}
  <p>Score: {{ user.points }}</p>
  {% else %}
    <p>Score: 0</p>
  {% endif %}
  <p>Email: {{ user.email }}</p>
  <p>Grade: {{ user.grade }}</p>
  <p>Gift: {{ user.gift }}</p>
  {% if user.participating == 0%}
    <p>You are not currently participating in the Omega Games.  Your account may not yet be verified, or you may have been removed from the competition.</p>
  {% endif %}

  {% if user.admin == 1 %}
    <!-- dont worry about styling this Katie -->
    <p>Admin panel:</p>
    <form method = "post" action="{{ url_for('main.admin') }}">
      <label for="username">Username:</label>
      <input name="username" placeholder="username">
      <label for="column">Column: </label>
      <input name="column" placeholder="column name">
      <label for="points">Value:</label>
      <input name="points" placeholder="column value">
      <input type="hidden" name="admin_action" value="update_user">
      <input type="submit" value="change data">
    </form>
    <form method = "post" action="{{ url_for('main.admin') }}">
      <label for="username">Username:</label>
      <input name="username" placeholder="username">
      <input type="hidden" name="admin_action" value="reset_user">
      <input type="submit" value="reset user">
    </form>
    <form action ="{{ url_for('main.admin_pending')}}">
      <input type="submit" value="View pending submissions">
    </form>
  {% endif %}

  <form method="post">
    <label for="code">Submit code:</label>
    <input name="code" placeholder="Enter code here">
    <input type="submit" value="Submit code">
  </form>

  <h2>Challenge list:</h2>
  <ul>
    {% for challenge in challenges %}
    {% if datetime.fromisoformat(challenge.release) < datetime.now() %}
      {% if challenge.type == "code" %}
      <li class="challenge-code">
      {% elif challenge.type == "live" %}
      <li class="challenge-live">
      {% else %}
      <li class="challenge-other">
      {% endif %}
        {{ challenge.name }} - {{ challenge.points }} points
        <p>{{ challenge.description }}</p>
        {% if challenge.type == "submission" %}
          <a href="{{ url_for('main.submission', challenge_id=challenge.id) }}">Submit here</a>
        {% endif %}

        {% if challenge.html %}
          <div class="challenge-html">
            {{ challenge.html|safe }}
          </div>
        {% endif %}
        {% if ((challenge.id | string) in json.loads(user.completed)['challenges'] and json.loads(user.completed)['challenges'][challenge.id | string][0] == 'completed') or (challenge.type== "code" and challenge.code in json.loads(user.completed)['codes']) %}
          <p>Completed!</p>
        {% endif %}
        {% if ((challenge.id | string) in json.loads(user.completed)['challenges'] and json.loads(user.completed)['challenges'][challenge.id | string][0] == 'pending') %}
          <p>Submission pending review.</p>
        {% endif %}
      </li>
    {% elif  (datetime.fromisoformat(challenge.release) - datetime.now() ).days > 1%}
      <li class="challenge-locked">
        
        {{ challenge.name }} - Locked for {{ (datetime.fromisoformat(challenge.release) - datetime.now() ).days }} days
      </li>
    {% elif  (datetime.fromisoformat(challenge.release) - datetime.now() ).days == 1%}
      <li class="challenge-locked">
        {{if }}
        {{ challenge.name }} - Locked for 1 day
      </li>
    {% elif (datetime.fromisoformat(challenge.release) - datetime.now() ).seconds//3600 > 1%}
      <li class="challenge-locked">
        {{ challenge.name }} - Locked for {{ (datetime.fromisoformat(challenge.release) - datetime.now() ).seconds//3600 }} hours
      </li>
    {% elif (datetime.fromisoformat(challenge.release) - datetime.now() ).seconds//3600 == 1%}
      <li class="challenge-locked">
        {{ challenge.name }} - Locked for 1 hour
      </li>
     {% elif (datetime.fromisoformat(challenge.release) - datetime.now() ).seconds//60 > 1%}
      <li class="challenge-locked">
        {{ challenge.name }} - Locked for {{ (datetime.fromisoformat(challenge.release) - datetime.now() ).seconds//60 }} minutes
      </li>
    {% elif (datetime.fromisoformat(challenge.release) - datetime.now() ).seconds//60 == 1%}
      <li class="challenge-locked">
        {{ challenge.name }} - Locked for 1 minute
      </li>
     {% else %}
      <li class="challenge-locked">
        {{ challenge.name }} - Locked for less than a minute
      </li>
    {% endif %}
    {% endfor %}

{% endblock %}